# bd4h_project


This purpose of this project is to replicate the procedure and results of the 2018 paper: **A disease inference method based on symptom extraction and bidirectional Long Short Term Memory networks**, available at https://ieeexplore.ieee.org/document/8621182.

## Datasets

This project uses the MIMIC-III v1.4 dataset--specifically the `NOTEEVENTS` and `DIAGNOSES_ICD` tables. 

MetaMap is used to extract the symptoms for the 50 most-common diseases and 100 most-common diseases from discharge summaries in the `NOTEEVENTS` table. 

**NOTE:** for this project, MetaMap was used to extract symptoms for the 50 most-common diseases.

Due to MIMIC-III containing sensitive real-life patient data, such data is not included in this repository.

<br>

Additional datasets are be generated via MetaMap in `run_metamap.py`. These datasets, if generated, would be available in the `mimic_data` folder:
- **symptoms_top_50.csv**: contains the symptoms extracted via MetaMap from the MIMIC-III NOTEEVENTS table for the top 50 most-common diseases
- **symptoms_top_100.csv**: contains the symptoms extracted via MetaMap from the MIMIC-III NOTEEVENTS table for the top 100 most-common diseases

<br>

Previously, fake data generated by GenAI was used, which is now located in the `fake_data` folder:
- **summaries.csv**: contains GenAI-generated patient IDs and discharge summaries
- **diagnoses.csv**: contains GenAI-generated patient IDs and disease diagnoses
- **symptoms.csv**: contains the symptoms extracted by MetaMap for each patient ID


## Running `run_metamap.py`

`run_metamap.py` is responsible for preprocessing the datasets to extract symptoms from written reports on patient symptoms.

### Dependencies 

The following python packages are required:
- `pymetamap`
- `pandas`
- `matplotlib`

To run `run_metamap.py`, MetaMap2020 is required and can be found at: https://lhncbc.nlm.nih.gov/ii/tools/MetaMap.html. The Java Runtime Environment (JRE) is also required to run MetaMap.

Furthermore, the python package `pymetamap` must be installed as well: https://github.com/AnthonyMRios/pymetamap.

`run_metamap.py` was tested and run on MetaMap2020's Linux distribution on an Intel Core i7-10700F @ 2.90GHz (16 cores) with 32 GB RAM.

### How to Run

Before running, download the `NOTEEVENTS` and `DIAGNOSES_ICD` tables from [MIMIC-III](https://physionet.org/content/mimiciii/1.4/) and add it to a `./mimic_data` folder in the base directory that `run_metamap.py` is located in.

Furthermore, inside `run_metamap.py`, there is a line like this:
```python
mm_base_dir = '/home/qwer/metamap/public_mm/'
```
Update the path with your MetaMap installation directory.

<br>

To run the file, run the command:
```bash
python run_metamap.py
```

This assumes that the [necessary MetaMap servers](https://lhncbc.nlm.nih.gov/ii/tools/MetaMap/Docs/README.html) have been launched already.

<br>


To run the file and also start/stop the servers inside the script, run the command:
```bash
python run_metamap.py -s
```

<br>

By default, `run_metamap.py` will extract the summaries for the top 50 most-common diseases. To extract summaries for the top 100 most-common diseases, add the `-n` flag:
```bash
python run_metamap.py -n 100
```

## Running `main.ipynb`

`main.ipynb` is responsible for training and evaluating the relevant word embeddings + BiLSTMs discussed in the paper.

### Dependencies 
The following python packages are required:
- `nltk`
- `numpy`
- `pandas`
- `scikit-learn`
- `gensim`
- `tensorflow`


### How to Run
Upon running the file in Google Colab, upload the following datasets from the `mimic_data` folder into the base directory of the Colab notebook:
- **symptoms_top_50.csv**: upload if performing classification for the top 50 most-common diseases
- **symptoms_top_100.csv**: upload if performing classification for the top 100 most-common diseases
- **DIAGNOSES_ICD.csv**: contains the patient ICD diagnoses

Afterwards, simply choose `Run all`.



